"use strict";

var Autocomplete = function Autocomplete(selector, data) {
  var inputs = document.querySelectorAll(selector);

  function ciSearch() {
    var what = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
    var where = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';
    return where.toUpperCase().search(what.toUpperCase());
  }

  inputs.forEach(function (input) {
    input.classList.add('autocomplete-input');
    var wrap = document.createElement('div');
    wrap.className = 'autocomplete-wrap';
    input.parentNode.insertBefore(wrap, input);
    wrap.appendChild(input);
    var list = document.createElement('div');
    list.className = 'autocomplete-list';
    wrap.appendChild(list);
    var matches = [];
    var listItems = [];
    var focusedItem = -1;

    function setActive() {
      var active = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
      if (active) wrap.classList.add('active');else wrap.classList.remove('active');
    }

    function focusItem(index) {
      if (!listItems.length) return false;
      if (index > listItems.length - 1) return focusItem(0);
      if (index < 0) return focusItem(listItems.length - 1);
      focusedItem = index;
      unfocusAllItems();
      listItems[focusedItem].classList.add('focused');
    }

    function unfocusAllItems() {
      listItems.forEach(function (item) {
        item.classList.remove('focused');
      });
    }

    function selectItem(index) {
      if (!listItems[index]) return false;
      input.value = listItems[index].innerText;
      setActive(false);
    }

    input.addEventListener('input', function () {
      var value = input.value;
      if (!value) return setActive(false);
      list.innerHTML = '';
      listItems = [];
      data.forEach(function (dataItem, index) {
        var search = ciSearch(value, dataItem);
        if (search === -1) return false;
        matches.push(index);
        var parts = [dataItem.substr(0, search), dataItem.substr(search, value.length), dataItem.substr(search + value.length, dataItem.length - search - value.length)];
        var item = document.createElement('div');
        item.className = 'autocomplete-item';
        item.innerHTML = parts[0] + '<strong>' + parts[1] + '</strong>' + parts[2];
        list.appendChild(item);
        listItems.push(item);
        item.addEventListener('click', function () {
          selectItem(listItems.indexOf(item));
        });
      });

      if (listItems.length > 0) {
        focusItem(0);
        setActive(true);
      } else setActive(false);
    });
    input.addEventListener('keydown', function (e) {
      var keyCode = e.keyCode;

      if (keyCode === 40) {
        // arrow down
        e.preventDefault();
        focusedItem++;
        focusItem(focusedItem);
      } else if (keyCode === 38) {
        //arrow up
        e.preventDefault();
        if (focusedItem > 0) focusedItem--;
        focusItem(focusedItem);
      } else if (keyCode === 27) {
        // escape
        setActive(false);
      } else if (keyCode === 13) {
        // enter
        selectItem(focusedItem);
      }
    });
    document.body.addEventListener('click', function (e) {
      if (!wrap.contains(e.target)) setActive(false);
    });
  });
};

fetch('../../JSON/search-autocomplete.json').then(function (data) {
  data.json().then(function (json) {
    var searchItems = json.itemsSearch;
    Autocomplete('#autocomplete', searchItems);
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiQXV0b2NvbXBsZXRlIiwic2VsZWN0b3IiLCJkYXRhIiwiaW5wdXRzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiY2lTZWFyY2giLCJ3aGF0Iiwid2hlcmUiLCJ0b1VwcGVyQ2FzZSIsInNlYXJjaCIsImZvckVhY2giLCJpbnB1dCIsImNsYXNzTGlzdCIsImFkZCIsIndyYXAiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSIsImFwcGVuZENoaWxkIiwibGlzdCIsIm1hdGNoZXMiLCJsaXN0SXRlbXMiLCJmb2N1c2VkSXRlbSIsInNldEFjdGl2ZSIsImFjdGl2ZSIsInJlbW92ZSIsImZvY3VzSXRlbSIsImluZGV4IiwibGVuZ3RoIiwidW5mb2N1c0FsbEl0ZW1zIiwiaXRlbSIsInNlbGVjdEl0ZW0iLCJ2YWx1ZSIsImlubmVyVGV4dCIsImFkZEV2ZW50TGlzdGVuZXIiLCJpbm5lckhUTUwiLCJkYXRhSXRlbSIsInB1c2giLCJwYXJ0cyIsInN1YnN0ciIsImluZGV4T2YiLCJlIiwia2V5Q29kZSIsInByZXZlbnREZWZhdWx0IiwiYm9keSIsImNvbnRhaW5zIiwidGFyZ2V0IiwiZmV0Y2giLCJ0aGVuIiwianNvbiIsInNlYXJjaEl0ZW1zIiwiaXRlbXNTZWFyY2giXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBTUEsWUFBWSxHQUFHLFNBQWZBLFlBQWUsQ0FBQ0MsUUFBRCxFQUFXQyxJQUFYLEVBQW9CO0FBRXhDLE1BQUlDLE1BQU0sR0FBR0MsUUFBUSxDQUFDQyxnQkFBVCxDQUEwQkosUUFBMUIsQ0FBYjs7QUFFQSxXQUFTSyxRQUFULEdBQXlDO0FBQUEsUUFBdkJDLElBQXVCLHVFQUFoQixFQUFnQjtBQUFBLFFBQVpDLEtBQVksdUVBQUosRUFBSTtBQUN4QyxXQUFPQSxLQUFLLENBQUNDLFdBQU4sR0FBb0JDLE1BQXBCLENBQTJCSCxJQUFJLENBQUNFLFdBQUws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LElBQVosQ0FBaUIsVUFBQUMsSUFBSSxFQUFJO0FBQ3hCLFFBQUlDLFdBQVcsR0FBR0QsSUFBSSxDQUFDRSxXQUF2QjtBQUNBckQsSUFBQUEsWUFBWSxDQUFDLGVBQUQsRUFBa0JvRCxXQUFsQixDQUFaO0FBQ0EsR0FIRDtBQUlBLENBTEQiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBBdXRvY29tcGxldGUgPSAoc2VsZWN0b3IsIGRhdGEpID0+IHtcclxuXHJcblx0bGV0IGlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpO1xyXG5cclxuXHRmdW5jdGlvbiBjaVNlYXJjaCh3aGF0ID0gJycsIHdoZXJlID0gJycpIHtcclxuXHRcdHJldHVybiB3aGVyZS50b1VwcGVyQ2FzZSgpLnNlYXJjaCh3aGF0LnRvVXBwZXJDYXNlKCkpO1xyXG5cdH1cclxuXHJcblx0aW5wdXRzLmZvckVhY2goaW5wdXQgPT4ge1xyXG5cclxuXHRcdGlucHV0LmNsYXNzTGlzdC5hZGQoJ2F1dG9jb21wbGV0ZS1pbnB1dCcpO1xyXG5cdFx0bGV0IHdyYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdHdyYXAuY2xhc3NOYW1lID0gJ2F1dG9jb21wbGV0ZS13cmFwJztcclxuXHRcdGlucHV0LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHdyYXAsIGlucHV0KTtcclxuXHRcdHdyYXAuYXBwZW5kQ2hpbGQoaW5wdXQpO1xyXG5cclxuXHRcdGxldCBsaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHRsaXN0LmNsYXNzTmFtZSA9ICdhdXRvY29tcGxldGUtbGlzdCc7XHJcblx0XHR3cmFwLmFwcGVuZENoaWxkKGxpc3QpO1xyXG5cclxuXHRcdGxldCBtYXRjaGVzID0gW107XHJcblx0XHRsZXQgbGlzdEl0ZW1zID0gW107XHJcblx0XHRsZXQgZm9jdXNlZEl0ZW0gPSAtMTtcclxuXHJcblx0XHRmdW5jdGlvbiBzZXRBY3RpdmUoYWN0aXZlID0gdHJ1ZSkge1xyXG5cdFx0XHRpZiAoYWN0aXZlKVxyXG5cdFx0XHRcdHdyYXAuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcblx0XHRcdGVsc2VcclxuXHRcdFx0XHR3cmFwLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIGZvY3VzSXRlbShpbmRleCkge1xyXG5cdFx0XHRpZiAoIWxpc3RJdGVtcy5sZW5ndGgpIHJldHVybiBmYWxzZTtcclxuXHRcdFx0aWYgKGluZGV4ID4gbGlzdEl0ZW1zLmxlbmd0aCAtIDEpIHJldHVybiBmb2N1c0l0ZW0oMCk7XHJcblx0XHRcdGlmIChpbmRleCA8IDApIHJldHVybiBmb2N1c0l0ZW0obGlzdEl0ZW1zLmxlbmd0aCAtIDEpO1xyXG5cdFx0XHRmb2N1c2VkSXRlbSA9IGluZGV4O1xyXG5cdFx0XHR1bmZvY3VzQWxsSXRlbXMoKTtcclxuXHRcdFx0bGlzdEl0ZW1zW2ZvY3VzZWRJdGVtXS5jbGFzc0xpc3QuYWRkKCdmb2N1c2VkJyk7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiB1bmZvY3VzQWxsSXRlbXMoKSB7XHJcblx0XHRcdGxpc3RJdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG5cdFx0XHRcdGl0ZW0uY2xhc3NMaXN0LnJlbW92ZSgnZm9jdXNlZCcpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIHNlbGVjdEl0ZW0oaW5kZXgpIHtcclxuXHRcdFx0aWYgKCFsaXN0SXRlbXNbaW5kZXhdKSByZXR1cm4gZmFsc2U7XHJcblx0XHRcdGlucHV0LnZhbHVlID0gbGlzdEl0ZW1zW2luZGV4XS5pbm5lclRleHQ7XHJcblx0XHRcdHNldEFjdGl2ZShmYWxzZSk7XHJcblx0XHR9XHJcblxyXG5cdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKSA9PiB7XHJcblxyXG5cdFx0XHRsZXQgdmFsdWUgPSBpbnB1dC52YWx1ZTtcclxuXHRcdFx0aWYgKCF2YWx1ZSkgcmV0dXJuIHNldEFjdGl2ZShmYWxzZSk7XHJcblxyXG5cdFx0XHRsaXN0LmlubmVySFRNTCA9ICcnO1xyXG5cdFx0XHRsaXN0SXRlbXMgPSBbXTtcclxuXHJcblx0XHRcdGRhdGEuZm9yRWFjaCgoZGF0YUl0ZW0sIGluZGV4KSA9PiB7XHJcblxyXG5cdFx0XHRcdGxldCBzZWFyY2ggPSBjaVNlYXJjaCh2YWx1ZSwgZGF0YUl0ZW0pO1xyXG5cdFx0XHRcdGlmIChzZWFyY2ggPT09IC0xKSByZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0bWF0Y2hlcy5wdXNoKGluZGV4KTtcclxuXHJcblx0XHRcdFx0bGV0IHBhcnRzID0gW1xyXG5cdFx0XHRcdFx0ZGF0YUl0ZW0uc3Vic3RyKDAsIHNlYXJjaCksXHJcblx0XHRcdFx0XHRkYXRhSXRlbS5zdWJzdHIoc2VhcmNoLCB2YWx1ZS5sZW5ndGgpLFxyXG5cdFx0XHRcdFx0ZGF0YUl0ZW0uc3Vic3RyKHNlYXJjaCArIHZhbHVlLmxlbmd0aCwgZGF0YUl0ZW0ubGVuZ3RoIC0gc2VhcmNoIC0gdmFsdWUubGVuZ3RoKVxyXG5cdFx0XHRcdF07XHJcblxyXG5cdFx0XHRcdGxldCBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHRcdFx0aXRlbS5jbGFzc05hbWUgPSAnYXV0b2NvbXBsZXRlLWl0ZW0nO1xyXG5cdFx0XHRcdGl0ZW0uaW5uZXJIVE1MID0gcGFydHNbMF0gKyAnPHN0cm9uZz4nICsgcGFydHNbMV0gKyAnPC9zdHJvbmc+JyArIHBhcnRzWzJdO1xyXG5cdFx0XHRcdGxpc3QuYXBwZW5kQ2hpbGQoaXRlbSk7XHJcblx0XHRcdFx0bGlzdEl0ZW1zLnB1c2goaXRlbSk7XHJcblxyXG5cdFx0XHRcdGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRzZWxlY3RJdGVtKGxpc3RJdGVtcy5pbmRleE9mKGl0ZW0pKTtcclxuXHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdFx0aWYgKGxpc3RJdGVtcy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0Zm9jdXNJdGVtKDApO1xyXG5cdFx0XHRcdHNldEFjdGl2ZSh0cnVlKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHNldEFjdGl2ZShmYWxzZSk7XHJcblxyXG5cdFx0fSk7XHJcblxyXG5cdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGUgPT4ge1xyXG5cclxuXHRcdFx0bGV0IGtleUNvZGUgPSBlLmtleUNvZGU7XHJcblxyXG5cdFx0XHRpZiAoa2V5Q29kZSA9PT0gNDApIHsgLy8gYXJyb3cgZG93blxyXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0XHRmb2N1c2VkSXRlbSsrO1xyXG5cdFx0XHRcdGZvY3VzSXRlbShmb2N1c2VkSXRlbSk7XHJcblx0XHRcdH0gZWxzZSBpZiAoa2V5Q29kZSA9PT0gMzgpIHsgLy9hcnJvdyB1cFxyXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0XHRpZiAoZm9jdXNlZEl0ZW0gPiAwKSBmb2N1c2VkSXRlbS0tO1xyXG5cdFx0XHRcdGZvY3VzSXRlbShmb2N1c2VkSXRlbSk7XHJcblx0XHRcdH0gZWxzZSBpZiAoa2V5Q29kZSA9PT0gMjcpIHsgLy8gZXNjYXBlXHJcblx0XHRcdFx0c2V0QWN0aXZlKGZhbHNlKTtcclxuXHRcdFx0fSBlbHNlIGlmIChrZXlDb2RlID09PSAxMykgeyAvLyBlbnRlclxyXG5cdFx0XHRcdHNlbGVjdEl0ZW0oZm9jdXNlZEl0ZW0pO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0fSk7XHJcblxyXG5cdFx0ZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcblx0XHRcdGlmICghd3JhcC5jb250YWlucyhlLnRhcmdldCkpIHNldEFjdGl2ZShmYWxzZSk7XHJcblx0XHR9KTtcclxuXHJcblx0fSk7XHJcblxyXG59O1xyXG5cclxuZmV0Y2goJy4uLy4uL0pTT04vc2VhcmNoLWF1dG9jb21wbGV0ZS5qc29uJykudGhlbihkYXRhID0+IHtcclxuXHRkYXRhLmpzb24oKS50aGVuKGpzb24gPT4ge1xyXG5cdFx0bGV0IHNlYXJjaEl0ZW1zID0ganNvbi5pdGVtc1NlYXJjaDtcclxuXHRcdEF1dG9jb21wbGV0ZSgnI2F1dG9jb21wbGV0ZScsIHNlYXJjaEl0ZW1zKTtcclxuXHR9KTtcclxufSk7Il0sImZpbGUiOiJtYWluLmpzIn0=
